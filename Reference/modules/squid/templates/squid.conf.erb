<% 
auth_type = scope.lookupvar('squid::params::auth_enabled_type')
case auth_type
	when 'ldap':
-%>
#
# LDAP AUTH File
#
include <%= scope.lookupvar('squid::params::config_path') %>/conf.d/ldap.conf
#
<%
	when 'basic':
-%>
#
# BASIC Auth File acls
#
include <%= scope.lookupvar('squid::params::config_path') %>/conf.d/auth_param.conf
<%
	when 'none':
	when nil:
end
-%>
#
# ACLs Filters generated
#
include <%= scope.lookupvar('squid::params::config_path') %>/conf.d/acls.conf
#
# HTTP access acls
#
include <%= scope.lookupvar('squid::params::config_path') %>/conf.d/http_access.conf

# ICP access
icp_access allow localnet
icp_access deny all
#
# Squid configuration
#
http_port <%= scope.lookupvar('squid::params::hostname') %>:<%= scope.lookupvar('squid::params::port') %>
hierarchy_stoplist cgi-bin ?
cache_mem 8 MB
cache_dir ufs /var/spool/<%= scope.lookupvar('squid::params::service_name') %> <%= scope.lookupvar('squid::params::cache_size') %> 16 256
access_log /var/log/<%= scope.lookupvar('squid::params::service_name') %>/access.log squid
# Debug ACLs
#debug_options ALL,1 33,2
#access_log stdio:/var/log/squid/squid.log
emulate_httpd_log <%= scope.lookupvar('squid::params::emulate_httpd_log') %>
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern (Release|Package(.gz)*)$	0	20%	2880
refresh_pattern .		0	20%	4320
acl shoutcast rep_header X-HTTP09-First-Line ^ICY.[0-9]
<%
if scope.lookupvar('squid::params::service_name') == "squid"
-%>
upgrade_http0.9 deny shoutcast
acl apache rep_header Server ^Apache
broken_vary_encoding allow apache
extension_methods REPORT MERGE MKACTIVITY CHECKOUT
<%
else
-%>
#upgrade_http0.9 deny shoutcast
#acl apache rep_header Server ^Apache
#broken_vary_encoding allow apache
#extension_methods REPORT MERGE MKACTIVITY CHECKOUT
<%
end
-%>
hosts_file /etc/hosts
coredump_dir /var/spool/<%= scope.lookupvar('squid::params::service_name') %>