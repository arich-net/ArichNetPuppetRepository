# Postfix main.cf
# See /usr/share/postfix/main.cf.dist for a commented, more complete version

smtpd_banner = <%= scope.lookupvar('postfix::params::myhostname') %> ESMTP $mail_name
biff = no

# appending .domain is the MUA's job.
append_dot_mydomain = <%= scope.lookupvar('postfix::params::append_dot_mydomain') %>

# Uncomment the next line to generate "delayed mail" warnings
#delay_warning_time = 4h

myhostname = <%= scope.lookupvar('postfix::params::myhostname') %>
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
<% if (@operatingsystem =~ /RedHat/) -%>
# Setting for <%= @operatingsystem %>
myorigin = root@<%= scope.lookupvar('postfix::params::myhostname') %>
<% else -%>
# Setting for <%= @operatingsystem %>
myorigin = /etc/mailname
<% end -%>
mydestination = localhost, <%= scope.lookupvar('postfix::params::myhostname') %>
relayhost = <%= scope.lookupvar('postfix::params::relayhost') %>
mynetworks = <%= scope.lookupvar('postfix::params::mynetworks').join(', ') %>

mailbox_command = procmail -a "$EXTENSION"
mailbox_size_limit = 0
recipient_delimiter = +

inet_interfaces = <%= scope.lookupvar('postfix::params::inet_interfaces') %>

disable_vrfy_command = yes
smtpd_helo_required = yes

smtpd_helo_restrictions =
        check_client_access hash:/etc/postfix/access_client,
        permit_mynetworks,
        permit

smtpd_recipient_restrictions =
  check_recipient_access regexp:/etc/postfix/recipient_access,
  permit_mynetworks, reject_unauth_destination
# reject_unknown_recipient_domain = yes
inet_protocols = ipv4

smtpd_tls_cert_file = none

# File size limit - Puppet change
message_size_limit = <%= scope.lookupvar('postfix::params::messagesizelimit') %>

# TCP Connections Settings
smtpd_client_connection_count_limit = <%= scope.lookupvar('postfix::params::smtpd_client_connection_count_limit') %>
smtpd_client_connection_rate_limit = <%= scope.lookupvar('postfix::params::smtpd_client_connection_rate_limit') %>
anvil_rate_time_unit = <%= scope.lookupvar('postfix::params::anvil_rate_time_unit') %>
